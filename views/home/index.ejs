<!doctype html>
<html class="no-js" lang="zxx">
<%- include("layouts/header"); -%>
    <body>
        <%- include("layouts/navbar"); -%>
            <main>
                <!-- slider area start -->
                <section class="slider-area pb-20 p-rel">
                    <div class="slider-active dot-style dot-style-1 dot-right">
                        <div class="single-slider slider-height" data-background="assets/home/img/slider/slider-1.jpg">
                        </div>
                        <div class="single-slider slider-height" data-background="assets/home/img/slider/slider-2.jpg">
                        </div>
                        <div class="single-slider slider-height" data-background="assets/home/img/slider/slider-3.jpg">
                        </div>
                        <div class="single-slider slider-height" data-background="assets/home/img/slider/slider-1.jpg">
                        </div>
                    </div>
                    <div class="slider-scroll p-abs">
                        <a href="#category-area"><i class="fal fa-angle-double-down"></i></a>
                    </div>
                </section>
                <!-- slider area end -->

                <!-- category area start -->
                <div class="category-area pb-75" id="category-area">
                    <div class="pl-20 pr-20">
                        <div class="row row-2">
                            <div class="col-xxl-6 col-xl-6 col-md-6 col-12">
                                <div class="single-category mb-20 p-rel wow fadeInUp" data-wow-delay=".1s">
                                    <a href="/shop">
                                        <div class="cat-thumb fix">
                                            <img src="assets/home/img/products/category-1.jpg" alt="#">
                                        </div>
                                        <div class="cat-content p-abs bottom-left">
                                            <h4 class="pb-15">T-Shirt 2021/22</h4>
                                            <span class="cat-subtitle">
                                                <%= countTShirt %> Products
                                            </span>
                                        </div>
                                    </a>
                                </div>
                            </div>
                            <div class="col-xxl-6 col-xxl-6 col-xl-6 col-md-6 col-12">
                                <div class="row row-2">
                                    <div class="col-xxl-6 col-xl-6 col-lg-6 col-md-6 col-sm-6">
                                        <a href="/shop">
                                            <div class="single-category mb-20 p-rel wow fadeInUp" data-wow-delay=".3s">
                                                <div class="cat-thumb fix">
                                                    <img src="/assets/uploads/image-1650423322523.jpg" alt="#">
                                                </div>
                                                <div class="cat-content p-abs bottom-left">
                                                    <h4 class="pb-15">Sweater</h4>
                                                    <span class="cat-subtitle">
                                                        <%= countSweater %> Products
                                                    </span>
                                                </div>
                                            </div>
                                        </a>
                                    </div>
                                    <div class="col-xxl-6 col-xl-6 col-lg-6 col-md-6 col-sm-6">
                                        <a href="/shop">
                                            <div class="single-category mb-20 p-rel wow fadeInUp" data-wow-delay=".6s">
                                                <div class="cat-thumb fix">
                                                    <img src="/assets/uploads/image-1650422760934.jpg" alt="#">
                                                </div>
                                                <div class="cat-content p-abs bottom-left">
                                                    <h4 class="pb-15">Men's shirts 2021/22</h4>
                                                    <span class="cat-subtitle">
                                                        <%= countMenShirt %> Products
                                                    </span>
                                                </div>
                                            </div>
                                        </a>
                                    </div>
                                    <div class="col-xxl-12">
                                        <a href="/shop">
                                            <div class="single-category mb-20 p-rel wow fadeInUp" data-wow-delay=".9s">
                                                <div class="cat-thumb fix">
                                                    <img src="assets/home/img/products/category-4.jpg" alt="#">
                                                </div>
                                                <div class="cat-content p-abs bottom-left">
                                                    <h4 class="pb-15">Blazer Cotton SS/21</h4>
                                                    <span class="cat-subtitle">28 Products</span>
                                                </div>
                                            </div>
                                        </a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- category area end -->

                <!-- top selling area start -->
                <div class="top-selling-area top-selling-padding pb-100">
                    <div class="container">
                        <div class="row">
                            <div class="col-xxl-12">
                                <div class="section-title top-selling-title text-center pb-47">
                                    <span class="p-subtitle">Explore The Lookbook</span>
                                    <h3 class="p-title pb-15 mb-0">Top Selling Products</h3>
                                    <p class="p-desc">Commodo sociosqu venenatis cras dolor sagittis integer luctus sem
                                        primis
                                        eget maecenas.</p>
                                </div>
                            </div>
                        </div>
                        <div class="row pb-20">
                            <% for(let i=0; i < products.length; i++) { %>
                                <div class="col-xxl-3 col-xl-3 col-lg-4 col-md-6 col-sm-6" id="<%= products[i]._id %>">
                                    <div class="single-product mb-15 wow fadeInUp" data-wow-delay=".1s">
                                        <div class="product-thumb">
                                            <img src="/assets/uploads/<%= products[i].productImage %>" alt="#">
                                            <div class="cart-btn cart-btn-1 p-abs">
                                                <a href="#">Add to cart</a>
                                            </div>
                                            <input type="text" value="<%= products[i].stock %>" id="product-stock"
                                                hidden />
                                            <input type="text" value="<%= products[i].categoryId.nameCategory %>"
                                                id="nameCategory" hidden />
                                            <div class="product-action product-action-1 p-abs">
                                                <a href="#" class="icon-box icon-box-1"
                                                    onclick="btnShowProduct('<%= products[i]._id %>')"
                                                    data-bs-toggle="modal" data-bs-target="#productModal">
                                                    <i class="fal fa-eye"></i>
                                                    <i class="fal fa-eye"></i>
                                                </a>
                                                <a href="#" class="icon-box icon-box-1">
                                                    <i class="fal fa-heart"></i>
                                                    <i class="fal fa-heart"></i>
                                                </a>
                                                <a href="#" class="icon-box icon-box-1">
                                                    <i class="fal fa-layer-group"></i>
                                                    <i class="fal fa-layer-group"></i>
                                                </a>
                                            </div>
                                        </div>
                                        <div class="product-content">
                                            <h4 class="pro-title pro-title-1"><a href="javascript:void(0)">
                                                    <%= products[i].nameProduct%>
                                                </a></h4>
                                            <div class="pro-price">
                                                <span>$<%= products[i].prices%></span>
                                                <del></del>
                                            </div>
                                            <div class="rating">
                                                <i class="fal fa-star active"></i>
                                                <i class="fal fa-star active"></i>
                                                <i class="fal fa-star active"></i>
                                                <i class="fal fa-star"></i>
                                                <i class="fal fa-star"></i>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <% } %>
                        </div>
                        <div class="row">
                            <div class="col-xxl-12">
                                <div class="btn-area text-center wow fadeInUp" data-wow-delay="1.2s">
                                    <div class="p-btn p-btn-1">
                                        <a href="/shop">SHOW ALL PRODUCTS</a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- top selling area end -->

                <!-- subscribe area start -->
                <div class="subscribe-area pb-100 gray-bg-2 pt-95">
                    <div class="container">
                        <div class="row">
                            <div class="col-xxl-12">
                                <div class="section-title text-center">
                                    <span class="p-subtitle">OUR NEWSLETTER</span>
                                    <h3 class="p-title pb-15 mb-0">join our newsletter</h3>
                                    <p class="p-desc  pb-15">Subscribe to the Puik Store mailing list to receive updates
                                        on new
                                        arrivals, special offers<br>
                                        and other discount information.</p>
                                </div>
                            </div>
                        </div>
                        <div class="row justify-content-center">
                            <div class="col-xxl-8 col-xl-8">
                                <div class="subscribe-form text-center">
                                    <form action="#">
                                        <input type="text" placeholder="Your email address...">
                                        <button type="submit" class="subscribe-btn subscribe-btn-1">Subscribe</button>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- subscribe area end -->

                <!-- product modal area start -->
                <div class="product__modal-area modal fade" id="productModal" tabindex="-1" role="dialog"
                    aria-labelledby="productModal" aria-hidden="true">
                    <div class="modal-dialog modal-dialog-centered" role="document">
                        <div class="modal-content">
                            <div class="product__modal-inner position-relative">
                                <div class="product__modal-close">
                                    <button data-bs-dismiss="modal" aria-label="Close">
                                        <i class="ti-close"></i>
                                    </button>
                                </div>
                                <div class="product__modal-left">
                                    <div class="tab-content mb-10" id="productModalThumb">
                                        <div class="tab-pane fade show active" id="pro-1" role="tabpanel"
                                            aria-labelledby="pro-1-tab">
                                            <div class="product__modal-thumb w-img">
                                                <img src="" alt="">
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="product__modal-right">
                                    <h3 class="product__modal-title">
                                        <a href="javascript:void(0)"></a>
                                    </h3>
                                    <div class="product__modal-rating d-flex align-items-center">
                                        <ul class="mr-10">
                                            <li>
                                                <a href="#"><i class="ti-star"></i></a>
                                            </li>
                                            <li>
                                                <a href="#"><i class="ti-star"></i></a>
                                            </li>
                                            <li>
                                                <a href="#"><i class="ti-star"></i></a>
                                            </li>
                                            <li>
                                                <a href="#"><i class="ti-star"></i></a>
                                            </li>
                                            <li>
                                                <a href="#"><i class="ti-star"></i></a>
                                            </li>
                                        </ul>
                                        <!-- <div class="customer-review">
                                <a href="#">(1 customer review)</a>
                            </div> -->
                                    </div>
                                    <div class="product__modal-price mb-10">
                                        <span class="price new-price"></span>
                                    </div>
                                    <div class="product__modal-available">
                                        <p> Availability: <span></span> </p>
                                    </div>
                                    <div class="product__modal-des">
                                        <p>Typi non habent claritatem insitam, est usus legentis in iis qui facit eorum
                                            claritatem. Investigationes demonstraverunt lectores legere me lius quod
                                            legunt saepius.…</p>
                                    </div>
                                    <div class="product__modal-quantity mb-15">
                                        <h5>Quantity:</h5>
                                        <form action="#">
                                            <div class="pro-quan-area d-sm-flex align-items-center">
                                                <div class="product-quantity mr-20 mb-25">
                                                    <div class="cart-plus-minus p-relative"><input type="text"
                                                            value="1" /></div>
                                                </div>
                                                <div class="product__modal-cart mb-25">
                                                    <button class="product-modal-cart-btn" data-id="">Add to
                                                        cart</button>
                                                </div>
                                            </div>
                                        </form>
                                    </div>
                                    <div class="product__modal-categories d-sm-flex align-items-center">
                                        <span>Categories: </span><span class="title-category"></span>
                                    </div>
                                    <div class="product__modal-share d-sm-flex align-items-center">
                                        <span>Share this product: </span>
                                        <ul>
                                            <li>
                                                <a href="#"><i class="fab fa-facebook-f"></i></a>
                                            </li>
                                            <li>
                                                <a href="#"><i class="fab fa-twitter"></i></a>
                                            </li>
                                            <li>
                                                <a href="#"><i class="fab fa-pinterest-p"></i></a>
                                            </li>
                                            <li>
                                                <a href="#"><i class="fab fa-google-plus-g"></i></a>
                                            </li>
                                            <li>
                                                <a href="#"><i class="fab fa-linkedin-in"></i></a>
                                            </li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- product modal area start -->

            </main>
            <!-- footer area start -->
            <%- include("layouts/footer"); -%>
                <!-- footer area end -->

                <%- include("layouts/script"); -%>
                    <script type="text/javascript">
                        $(document).ready(function () {
                            $(".product-modal-cart-btn").click(function (e) {
                                e.preventDefault();
                                let totalMoney = $(".cartmini__total span").text().replace("$", "");
                                totalMoney = Number(totalMoney);
                                let product_id = $(this).attr("data-id");
                                let stock = $(".product__modal-available span").text();
                                stock = stock.replace(/[^0-9]/g, '');
                                let name = $(".product__modal-title a").text();
                                let price = $(".product__modal-price .price").text().replace("$", "");
                                let image = $(".product__modal-thumb img").attr("src");
                                let quantity = $(".product-quantity input").val();
                                let cart = localStorage.getItem('cart');
                                if (cart) {
                                    cart = JSON.parse(cart);
                                    let index = cart.findIndex(item => item.product_id == product_id);
                                    if (index != -1) {
                                        let s = Number(quantity) + Number(cart[index].quantity)
                                        if (s > Number(stock)) {
                                            Swal.fire({
                                                icon: 'error',
                                                title: 'Oops...',
                                                text: 'The number of stocks is not enough!',
                                            })
                                        }
                                        else {
                                            Swal.fire({
                                                icon: 'success',
                                                title: 'Add To Cart Success!',
                                                timer: 1500,
                                            })
                                            cart[index].quantity = s;
                                            $(`#item-${cart[index].product_id} .cartmini__price`).text(`${s} × ${cart[index].price}`);
                                            localStorage.setItem('cart', JSON.stringify(cart));
                                            totalMoney += Number(quantity) * Number(price);
                                            $(".cartmini__total span").text(`$${totalMoney}`)

                                            let countProduct = $("#countProduct").text();
                                            countProduct = Number(countProduct) + Number(quantity);
                                            $("#countProduct").text(countProduct)

                                        }
                                    }
                                    else {
                                        if (Number(quantity) > Number(stock)) {
                                            Swal.fire({
                                                icon: 'error',
                                                title: 'Oops...',
                                                text: 'The number of stocks is not enough!',
                                            })
                                        }
                                        else {
                                            Swal.fire({
                                                icon: 'success',
                                                title: 'Add To Cart Success!',
                                                timer: 1500,
                                            })

                                            cart.push({ product_id, name, price, quantity, image, stock });
                                            localStorage.setItem('cart', JSON.stringify(cart));
                                            addProductToCart(product_id, image, name, quantity, price, totalMoney)
                                        }
                                    }
                                }
                                else {
                                    if (Number(quantity) > Number(stock)) {
                                        Swal.fire({
                                            icon: 'error',
                                            title: 'Oops...',
                                            text: 'The number of stocks is not enough!',
                                        })
                                    }
                                    else {
                                        Swal.fire({
                                            icon: 'success',
                                            title: 'Add To Cart Success!',
                                            timer: 1500,
                                        })
                                        $(".cartmini__list ul").html(""); // Xóa bỏ chữ danh sách trống
                                        localStorage.setItem('cart', JSON.stringify([{ product_id, name, price, quantity, image, stock }]));
                                        addProductToCart(product_id, image, name, quantity, price, totalMoney)
                                    }
                                }
                            })
                        })

                        function addProductToCart(product_id, image, name, quantity, price, totalMoney) {
                            let content = '' +
                                `<li class="cartmini__item p-rel d-flex align-items-start" id="item-${product_id}">` +
                                '                            <div class="cartmini__thumb mr-15">' +
                                '                                <a href="javascript:void(0)">' +
                                `                                    <img src="${image}" alt="">` +
                                '                                </a>' +
                                '                            </div>' +
                                '                            <div class="cartmini__content">' +
                                '                                <h3 class="cartmini__title">' +
                                `                                    <a href="javascript:void(0)">${name}</a>` +
                                '                                </h3>' +
                                '                                <span class="cartmini__price">' +
                                `                                    <span class="price">${quantity} × $${price}</span>` +
                                '                                </span>' +
                                '                            </div>' +
                                `                            <a href="#" class="cartmini__remove" onclick="RemoveItemCart(\'${product_id}\')">` +
                                '                                <i class="fa-light fa-x"></i>' +
                                '                            </a>' +
                                '                        </li>' +
                                '';
                            $(".cartmini__list ul").append(content);
                            totalMoney += Number(quantity) * Number(price);
                            $(".cartmini__total span").text(`$${totalMoney}`)
                            let countProduct = $("#countProduct").text();
                            countProduct = Number(countProduct) + Number(quantity);
                            $("#countProduct").text(countProduct)

                        }

                        function btnShowProduct(id) {
                            let img = $(`#${id} .product-thumb img`).attr('src');
                            let name = $(`#${id} .product-content h4`).text();
                            let stock = $(`#${id} #product-stock`).val();
                            let price = $(`#${id} .pro-price span`).text();
                            let nameCategory = $(`#${id} #nameCategory`).val()

                            $(".product__modal-thumb img").attr('src', img);
                            $(".product__modal-title a").text(name);
                            $(".product__modal-price .price").text(price);
                            $(".product-quantity input").val("1");
                            let data = Number(stock) > 0 ? "In Stock" : "Out of stock";
                            if (Number(stock) == 0) {
                                $(".product__modal-available span").css("color", "red");
                            }
                            else {
                                $(".product__modal-available span").css("color", "green")
                            }
                            $(".product__modal-available span").text(data + ` (${stock} left)`)
                            $(".product__modal-categories .title-category").text(nameCategory)
                            $(".product-modal-cart-btn").attr('data-id', id);

                        }
                    </script>
    </body>

</html>